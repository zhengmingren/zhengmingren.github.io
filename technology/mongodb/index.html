<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="1. 文档​    文档是MongDB的核心概念，多个键以及关键值有序地放置在一起便是文档。例如：
​    { “greeting” : “hello,world!”, “foo” : 3}

文档中的键/值对是有序的，上面的文档和下面的文档是完全不同的：
{“foo” ：3 , “greetin" />
  

  
  
  
  
  
  
  <title>第一章 MongDB简介 | 行动的力量</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 文档​    文档是MongDB的核心概念，多个键以及关键值有序地放置在一起便是文档。例如：
​    { “greeting” : “hello,world!”, “foo” : 3}

文档中的键/值对是有序的，上面的文档和下面的文档是完全不同的：
{“foo” ：3 , “greeting” : “hello,world”}

文档中的值不仅可以是在双引号中的字符串，也可是其它几种数据">
<meta property="og:type" content="article">
<meta property="og:title" content="第一章 MongDB简介">
<meta property="og:url" content="http://yoursite.com/technology/mongodb/index.html">
<meta property="og:site_name" content="行动的力量">
<meta property="og:description" content="1. 文档​    文档是MongDB的核心概念，多个键以及关键值有序地放置在一起便是文档。例如：
​    { “greeting” : “hello,world!”, “foo” : 3}

文档中的键/值对是有序的，上面的文档和下面的文档是完全不同的：
{“foo” ：3 , “greeting” : “hello,world”}

文档中的值不仅可以是在双引号中的字符串，也可是其它几种数据">
<meta property="og:updated_time" content="2017-04-06T05:57:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第一章 MongDB简介">
<meta name="twitter:description" content="1. 文档​    文档是MongDB的核心概念，多个键以及关键值有序地放置在一起便是文档。例如：
​    { “greeting” : “hello,world!”, “foo” : 3}

文档中的键/值对是有序的，上面的文档和下面的文档是完全不同的：
{“foo” ：3 , “greeting” : “hello,world”}

文档中的值不仅可以是在双引号中的字符串，也可是其它几种数据">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="行动的力量" rel="home">行动的力量</a>
      </h1>
      
        <script type="text/javascript" src="http://api.hitokoto.us/rand?encode=js&charset=utf-8"></script>
        <h2 class="site-description"><script>hitokoto();</script></h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/categories/technology">技术</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/categories/article">文章</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/categories/movie">电影</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/categories/music">音乐</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main"><article id="post-mongodb" class="post-mongodb post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title article-title">
      第一章 MongDB简介
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/technology/mongodb/" data-id="cj17jsweh000ggazqqcvzxr0n" class="leave-reply bdsharebuttonbox" data-cmd="more">undefined</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h3 id="1-文档"><a href="#1-文档" class="headerlink" title="1. 文档"></a>1. 文档</h3><p>​    文档是MongDB的核心概念，多个键以及关键值有序地放置在一起便是文档。例如：</p>
<p>​    { “greeting” : “hello,world!”, “foo” : 3}</p>
<ul>
<li><p>文档中的键/值对是有序的，上面的文档和下面的文档是完全不同的：</p>
<p>{“foo” ：3 , “greeting” : “hello,world”}</p>
</li>
<li><p>文档中的值不仅可以是在双引号中的字符串，也可是其它几种数据类型，甚至是嵌入文档。这个例子中“greeting”的值是字符串，而“foo”的值是个整数。</p>
</li>
<li><p>文档的键是字符串。除了少数例外情况，键可以使用任意UTP-8字符。</p>
<ul>
<li>键不能包含\0(空字符)。这个字符用来表示键的结尾。</li>
<li>.和$有特别的意义，只有在特殊环境下才能使用。</li>
<li>以下划线“_”开头的键是保留的，虽然这个并不是严格要求。</li>
</ul>
</li>
<li><p>MongDB不但区分类型，也区分大小写。</p>
</li>
<li><p>MongDB的文档不能有重复的键。</p>
</li>
</ul>
<h3 id="2-集合"><a href="#2-集合" class="headerlink" title="2. 集合"></a>2. 集合</h3><p>​    集合就是一组文档，就如同关系型数据库中的表。集合是无模式的，这就是说一个集合里面的文档可以是各式各样的，这些文档不光是值的类型不同，它们的键也是可以完全不一样的。</p>
<p>集合的命名：</p>
<ul>
<li>集合名不能是空字符串“”。</li>
<li>集合名不能含有\0字符（空字符），这个字符表示集合名的结尾。</li>
<li>集合名不能以“system.”开头，这是为系统集合保留的前缀。例如system.users这个集合保存着数据库的用户信息，system.namespaces集合保存着所有数据库集合的信息。</li>
<li>集合名不能含有保留字符$。</li>
</ul>
<p>​    组织集合的一种惯例是使用“ . ” 字符分开的按命名空间划分的子集合。例如，一个带有博客功能的应用可能包含两个集合，分别是blog.posts和blog.authors。这样做的目的只是为了使组织结构更好些。</p>
<h3 id="3-数据库"><a href="#3-数据库" class="headerlink" title="3. 数据库"></a>3. 数据库</h3><p>MongDB中多个文档组成集合，同样多个集合组成数据库，一个MongDB实例可以承载多个数据库，它们之间可以视为完全独立的。每个数据库都有独立的权限控制，一般将一个应用的所有数据都存在同一个数据库中。</p>
<p>和集合一样，数据库也通过名字来标识。数据库名可以是满足以下条件的任意UTF- 8字符串：</p>
<ul>
<li>不能是空字符串（””）。</li>
<li>不得含有’’（），.，$，/，\，和\0（空字符）。</li>
<li>应全部小写。</li>
<li>最多64字节。</li>
</ul>
<p>数据库名最终会变成文件系统里的文件，因此会有如此多的限制。有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库，如下：</p>
<ul>
<li><p>admin</p>
<p>从权限啊角度来看，这是“root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</p>
</li>
<li><p>local</p>
<p>这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合。</p>
</li>
<li><p>config</p>
<p>当Mong用于分片设置是，config数据库在内部使用，用于保存分片的相关信息。</p>
</li>
</ul>
<p>把数据库的名字放到集合名前面，这就是集合的完全限定名，称为<em>命名空间</em>。例如，如果你在cms数据库中使用blog.posts集合，那么这个集合的命名空间就是cms.blog.posts。命名空间的长度不得超过121字节，在实际使用当中应该小于100字节。</p>
<h3 id="4-MongDB-shell"><a href="#4-MongDB-shell" class="headerlink" title="4. MongDB shell"></a>4. MongDB shell</h3><p>MongDB自带一个JavaScript shell，可以从命令行与MongDB实例交互。通过他可以执行管理操作、检查运行实例，亦或做其他尝试。</p>
<h4 id="4-1-shell简介"><a href="#4-1-shell简介" class="headerlink" title="4.1 shell简介"></a>4.1 shell简介</h4><p>运行mongo启动shell：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mongo</span><br></pre></td></tr></table></figure>
<p>shell会在启动时自动连接MongDB服务器，所以要确保在shell之前启动mongod。</p>
<p>shell是完备的JavaScript解释器，可以运用任何JavaScript程序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; x = <span class="number">200</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line">&gt; x / <span class="number">5</span>;</span><br><span class="line"><span class="number">40</span></span><br></pre></td></tr></table></figure>
<p>还可以充分利用JavaScript的标准库。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; Math.<span class="built_in">sin</span>(Math.PI / <span class="number">2</span>);</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; <span class="keyword">new</span> Date(<span class="string">"2010/1/1"</span>);</span><br><span class="line"><span class="string">"Fri Jan 01 2010 00:00:00 GMT-0500 (EST)"</span></span><br><span class="line">&gt; <span class="string">"Hello, World!"</span>.replace(<span class="string">"World"</span>, <span class="string">"MongoDB"</span>);</span><br><span class="line">Hello, MongoDB</span><br></pre></td></tr></table></figure>
<p>也可以定义和调用JavaScript函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function">function <span class="title">factorial</span> <span class="params">(n)</span> </span>&#123;</span><br><span class="line">... <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">... <span class="keyword">return</span> <span class="function">n * <span class="title">factorial</span><span class="params">(n - <span class="number">1</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">&gt; fatorial(<span class="number">5</span>);</span><br><span class="line"><span class="number">120</span></span><br></pre></td></tr></table></figure>
<p>注意，可以使用多行命令。这个shell会检测输入的JavaScript语句是否写完，如没写完还可以在下一行接着写。</p>
<h4 id="4-2-shell基本操作"><a href="#4-2-shell基本操作" class="headerlink" title="4.2 shell基本操作"></a>4.2 shell基本操作</h4><ul>
<li><p>创建</p>
<p>insert函数添加一个文档到集合里面。例如，假设要储存一篇博客文章。首先，创建一个局部变量post，内容是代表文档的JavaScript对象。里面会有“title”，“content”和“date（发表日期）几个键”。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; post = &#123; <span class="string">"title"</span> : <span class="string">"My Blog Post"</span>,</span><br><span class="line"><span class="attribute">...</span><span class="string">"content"</span> : <span class="string">"Here is my blog post."</span>,</span><br><span class="line"><span class="attribute">...</span><span class="string">"date"</span> : <span class="literal">new</span> <span class="built_in">Date</span>()&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"title"</span> : <span class="string">"My Blog Post"</span>,</span><br><span class="line">  <span class="string">"content"</span> : <span class="string">"Here is my blog post."</span>,</span><br><span class="line">  <span class="string">"date"</span> : <span class="string">"Fri Jan 01 2010 00:00:00 GMT-0500 (EST)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个对象是个有效的MongDB文档，所以可以用insert方法将其保存到blog集合中：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db<span class="class">.blog</span><span class="class">.insert</span>(post)</span><br></pre></td></tr></table></figure>
<p>这篇文章已经被存到数据库里面了。</p>
</li>
<li><p>读取</p>
<p>find会返回集合里面的所有的文档。若只是想查看一个文档，可以用findOne：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="keyword">blog.findOne()</span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="string">"_id"</span> : ObjectId(<span class="string">"57ad256b18bc1402149e8ea9"</span>)</span><br><span class="line">  <span class="string">"title"</span> : <span class="string">"My Blog Post"</span>,</span><br><span class="line">  <span class="string">"content"</span> : <span class="string">"Here is my blog post."</span>,</span><br><span class="line">  <span class="string">"date"</span> : <span class="string">"Fri Jan 01 2010 00:00:00 GMT-0500 (EST)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>find和findOne可以接受查询文档形式的限定条件。这将通过查询限制匹配的文档。使用find时，shell自动显示最多20个匹配的文档但可以获取更多文档。</p>
</li>
<li><p>跟新</p>
<p>如果要更改博客文章，就要用到update了。update接受（至少）接受两个参数：第一个是要跟新文档的限定条件，第二是新的文档。假设决定给我们先前写的文章增加内容，则需要你增加一个新的键，对应的值是存放评论的组。</p>
<p>第一步修改变量post，增加“comments”键：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; psot.comments = <span class="string">[]</span></span><br><span class="line"><span class="string">[ ]</span></span><br></pre></td></tr></table></figure>
<p>然后执行update操作，用新版本的文档替换标题为“My Blog Post”的文章：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="tag">db</span><span class="class">.blog</span><span class="class">.update</span>(<span class="rules">&#123;<span class="rule"><span class="attribute">title </span>:<span class="value"> <span class="string">"My Blog Post"</span></span></span></span>&#125;, <span class="tag">post</span>)</span><br></pre></td></tr></table></figure>
<p>文档已经有了“comments”键。再用find查看一下可以看到新的键：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.blog.findOne<span class="literal">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_id"</span> : <span class="type">ObjectId</span>(<span class="string">"57ad256b18bc1402149e8ea9"</span>)</span><br><span class="line">  <span class="string">"title"</span> : <span class="string">"My Blog Post"</span>,</span><br><span class="line">  <span class="string">"content"</span> : <span class="string">"Here is my blog post."</span>,</span><br><span class="line">  <span class="string">"date"</span> : <span class="string">"Fri Jan 01 2010 00:00:00 GMT-0500 (EST)"</span></span><br><span class="line">  <span class="string">"comments"</span> : <span class="literal">[]</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>移除</p>
<p>remove用来从数据库中永久性的删除文档。在不使用参数进行调用的情况下，它会删除一个集合内的所有文档。它也可以接受一个文档以指定限定条件。例如，下面的命令会删除我们刚刚创建的文章：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.blog.<span class="keyword">remove</span>(&#123;<span class="string">"title"</span> : <span class="string">"My Blog Post"</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>集合现在又是空的了。</p>
</li>
</ul>
<p>shell本身内置了帮助文档，可以通过help查看命令。</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; help</span><br><span class="line">HELP</span><br><span class="line">	<span class="literal">show</span> dbs				<span class="literal">show</span> database names</span><br><span class="line">	<span class="literal">show</span> collections	     <span class="literal">show</span> collections in <span class="literal">current</span> datebase</span><br><span class="line">	<span class="literal">show</span> users				<span class="literal">show</span> users in currentdatabase</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<p>使用db.help()可以查看数据库级别的命令的帮助，集合的相关帮助可以通过db.foo.help()来查看。在输入的时候不要输括号。这样就会显示该函数的JavaScript源代码。例如：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.foo.update</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(query, obj, upset, mulit)</span> </span>&#123;</span><br><span class="line">  assert(query, <span class="string">"need a query"</span>);</span><br><span class="line">  assert(obj, <span class="string">"need a object"</span>)</span><br><span class="line">  <span class="keyword">this</span>._validateObject(obj);</span><br><span class="line">  <span class="keyword">this</span>._mongo.update(<span class="keyword">this</span>._fullName, query, obj,</span><br><span class="line">  					upset ? <span class="literal">true</span> : <span class="literal">false</span>, multi ? <span class="literal">true</span> :<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-数据类型"><a href="#5-数据类型" class="headerlink" title="5 数据类型"></a>5 数据类型</h3><h4 id="5-1-基本数据类型"><a href="#5-1-基本数据类型" class="headerlink" title="5.1 基本数据类型"></a>5.1 基本数据类型</h4><p>MongoDB的文档类似与JSON，在概念上和JavaScript中的对象神似。JSON是一种简单的表示数据的方式，仅包含6种数据类型。这样易于理解、易于解析、易于记忆，但是JSON的表现力也有限制，因为只有null、布尔、数字、字符串、数组和对象几种类型。下面是MongDB通常支持的一些类型：</p>
<ul>
<li><p>null</p>
<p>null用于表示空值或者不存在的字段。</p>
<p>{“x” : “null”}</p>
</li>
<li><p>布尔</p>
<p>布尔类型有两个值“true”和“false”。</p>
<p>{“x” ：“false”}</p>
</li>
<li><p>32位整数</p>
<p>shell中这个类型不可用，32位整数会被自动转换为64位浮点数。</p>
</li>
<li><p>64位整数</p>
<p>​shell中这个类型不可用，32位整数会被自动转换为64位浮点数。</p>
</li>
<li><p>634位浮点数</p>
<p>shell中的数字类型都是这种类型。</p>
<p>{“x” ： ”3.14“}</p>
<p>这个也是浮点数：</p>
<p>{“x” ： “3”}</p>
</li>
<li><p>字符串</p>
<p>UTF-8字符串都可以表为字符串类型的数据。</p>
<p>{“x” ： “zheng”}</p>
</li>
<li><p>符号</p>
<p>shell不支持这种类型，shell将数据库里面的符号类型转换成字符串。</p>
</li>
<li><p>对象id</p>
<p>对象id是文档的122字节的唯一ID。</p>
<p>{“x” ： ObjectId()}</p>
</li>
<li><p>日期</p>
<p>日期类型存储的是从标准纪元开始的毫秒数。不存储时区。</p>
<p>{“x” ：new Date()}</p>
</li>
<li><p>正则表达式</p>
<p>文档中可以包含正则表达式，采用JavaScript的正则表达式语法。</p>
<p>{“x” ：”/fooobar/i}</p>
</li>
<li><p>代码</p>
<p>文档中还可以包含JavaScript代码。</p>
<p>{“x” ：function() { /<em>…</em>/}}</p>
</li>
<li><p>二进制数据</p>
<p>二进制数据可以由任意字节的串组成。不过shell中无法使用。</p>
</li>
<li><p>最大值</p>
<p>BSON包含一个特殊类型，表示可能的最大值。shell中没有这个类型。</p>
</li>
<li><p>最小值</p>
<p>BSON包含一个特殊类型，表示可能的最小值。shell中没有这个类型。</p>
</li>
<li><p>未定义</p>
<p>文档中也可以使用未定义类型。</p>
<p>{“x” ：undefined}</p>
</li>
<li><p>数组</p>
<p>值的集合或者列表可以表示成数组。</p>
<p>{“x” ：[“a”, “b”, “c”]}</p>
</li>
<li><p>内嵌文档</p>
<p>文档可以包含别的文档，也可以作为值嵌入到父文档中。</p>
<p>{“x” : {“foo” : “bar”}}</p>
</li>
</ul>
<h4 id="5-2-数字"><a href="#5-2-数字" class="headerlink" title="5.2 数字"></a>5.2 数字</h4><p>JavaScript中只有一种“数字”类型。因为Mongodb中有3种数据类型（32位整数、64位整数和64位浮点数），shell必须绕过JavaScript的限制。默认情况下，shell中的数字都被MongDB当做是双精度数。也就是你从数据库中获得的是一个32位整数，修改文档后，将文档存数据库的时候，这个整数也被转换成浮点数。</p>
<h4 id="5-3-日期"><a href="#5-3-日期" class="headerlink" title="5.3 日期"></a>5.3 日期</h4><p>在JavaScript中，Date对象用做MongDB的日期类型，创建一个新的Date对象时，通常会调用new Date(…)，而不是Date(…）。调用构造函数（也就是说不包括new）实际上会返回对日期的字符串表示，而不是真正的Date对象。</p>
<p>shell中的日期显示时使用本地时区设置。但是，日期在数据中是以从标准纪元开始的毫秒数的形式存储的，没有相关的时区信息。</p>
<h4 id="5-4-数组"><a href="#5-4-数组" class="headerlink" title="5.4 数组"></a>5.4 数组</h4><p>数组是一组值，既可以作为有序对象（像列表、栈或队列）来操作，也可以作为无序对象（像集合）操作。在下面的文档中，“things”这个键的值就是一个数组：</p>
<p>{“things” ：[“pie”, 3.14]}</p>
<p>从这个例子可以看到，数组可以包含不同数据类型的元素。实际上，常规键/值对支持的值都可以作为数组的元素，甚至是嵌套数组。</p>
<p>MongDB能“理解“其结构，并知道如何”深入“数组内部对其内容进行操作。这样就能用内容对数组进行查询和构建索引了，可以提高性能。MongDB可以使用原子更新修改数组内容，比如深入数组中含有3.14的文档。</p>
<h4 id="5-5-内嵌文档"><a href="#5-5-内嵌文档" class="headerlink" title="5.5 内嵌文档"></a>5.5 内嵌文档</h4><p>内嵌文档就是把整个MongDB文档作为另一个文档中键的一个值。这样数据可以组织得更自然些，不用非得存成扁平结构的。</p>
<p>例如，用一个文档来表示一个人，同时还要保存他的地址，可以将地址内嵌到”add-ress“文档中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>" : <span class="value"><span class="string">"John Doe"</span></span>,</span><br><span class="line">  "<span class="attribute">address</span>" : <span class="value">&#123;</span><br><span class="line">  				"<span class="attribute">street</span>" : <span class="value"><span class="string">"123 Park Street"</span></span>,</span><br><span class="line">  				"<span class="attribute">city</span>" : <span class="value"><span class="string">"Antown"</span></span>,</span><br><span class="line">  				"<span class="attribute">state</span>" : <span class="value"><span class="string">"NY"</span></span><br><span class="line">			</span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>上面例子中“address”的值是另一个文档，这个文档有自己的“street”、“city“、和”state“键值。</p>
<p>同数组一样，MongDB能够”理解“内嵌文档的结构，并能”深入“其中构建索引、执行查询、或者更新。</p>
<p>内嵌文档可以改变处理数据的方式。在关系型数中，这样的文档一般会被拆分为两个表（”people“和”address“）中的两个行。在MongDB中，就可以将地址文档直接嵌入人员文档中，使用得当的话，内嵌文档会使信息表示得更加自然和高效。但是，因为MongDB会存储更多重复的数据，这样是反规范化的，如果在关系型数据库中”address“在一个独立的表中，要修复地址中的拼写错误。当我们对”people”和“address”执行连接操作时，每一个使用这个地址的人的信息都会得到更新。但是在MongDB中，则需要在每个人的文档中修正拼写错误。</p>
<h4 id="5-6-id和ObjectId"><a href="#5-6-id和ObjectId" class="headerlink" title="5.6 _id和ObjectId"></a>5.6 _id和ObjectId</h4><p>MongDB中存储的文档必须有一个“_id”键。这个键的值可以是任何类型，默认是个ObjectId对象。在一个集合，每个文档都有唯一的” _id”值，来确保集合里面每个文档能被唯一标识。</p>
<ul>
<li><p>ObjectId</p>
<p>ObjectId是“_id”的默认类型。它设计成轻量型的，不同的机器都能用全局唯一的同种方法方便的生成它。这是MOngDB采用ObjectId，而不是其他比较常规的做法（比如自动增加的主键）的主要原因，因为在多个服务器上同步自动增加主键值即费力还费时。</p>
<p>ObjectId使用12字节的存储空间，每个字节两位十六进制数字，是一个24位的字符串。ObjectId的创建方式如下：</p>
<p>0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 </p>
<p>时间戳           |  机器       | PID    | 计数器</p>
<p>————————————————————</p>
<ul>
<li>前4个字节是从标准纪元开始的时间戳，单位为秒。</li>
<li>时间戳与随后的5个字节组合起来，提供了秒级别的唯一性。</li>
<li>由于时间戳在前，这意味着ObjectId大致会按照插入都的顺序排列，将其作为索引提高效率。</li>
<li>时间戳4个字节也隐含了文档创建时间，绝大多数驱动都会公开一个方法从ObjectId获取这个信息。</li>
<li>接下来的3字节是所在主机的唯一标识。通常是机器主机名的散列值。这样就可以确保不同主机生成不同的ObjectId的进程标识符，不产生冲突。</li>
<li>为了确保在同一机器上并发的多个进程产生的ObjectId是唯一的，接下来的两个字节来自产生ObjectId的进程标识符（PID）。</li>
</ul>
<p>前9字节保证了同一秒钟不同机器不同进程产生的ObjectId是唯一的。后3字节就是一个自动增加的计数器，确保相同进程同一秒产生的ObjectId也是不一样的。同一秒钟最多允许每个进程拥有256的3次方个不同的ObjectId。</p>
</li>
</ul>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/technology/mongodb/">
    <time datetime="2017-04-06T05:50:24.000Z" class="entry-date">
        2017-04-06
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/technology/">technology</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongDB/">MongDB</a></li></ul>

    </footer>
</article>


    
<nav class="nav-single">
    <h3 class="assistive-text">文章导航</h3>
    
        <span class="nav-previous"><a href="/technology/mongodb2/" rel="prev"><span class="meta-nav">←</span> 第二章 MongDB创建、更新及删除文档</a></span>
    
    
        <span class="nav-next"><a href="/technology/Linuxcommand2/" rel="next">第二章 Linux中不能不知道的概念 <span class="meta-nav">→</span></a></span>
    
</nav><!-- .nav-single -->







</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/technology/springmvc2/">第二章 Spring MVC简介</a>
          </li>
        
          <li>
            <a href="/technology/springmvc1/">第一章 Web MVC简介</a>
          </li>
        
          <li>
            <a href="/technology/mongodb2/">第二章 MongDB创建、更新及删除文档</a>
          </li>
        
          <li>
            <a href="/technology/mongodb/">第一章 MongDB简介</a>
          </li>
        
          <li>
            <a href="/technology/Linuxcommand2/">第二章 Linux中不能不知道的概念</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MongDB/" style="font-size: 10px;">MongDB</a> <a href="/tags/springmvc/" style="font-size: 10px;">springmvc</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2017 A MAN
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>